<!doctype html>
<html>
<head>
<title>mark14.5</title>
<style>
* {
  font-family: Helvetica;
  margin: 0px;
  padding: 0px;
}
#textarea {
  border: 1px solid blac;
  width: 100%;
  height: 300px;
  font-size: 20px;
  font-family: monospace;
}
</style>
<meta name = "viewport" content = "width = device-width, initial-scale=1, user-scalable=yes">
</head>
<body>
<textarea id=textarea>
setn x 0
setn endx 1000000
label my_loop
incr x
eq x endx
as my_cond
if_false_goto my_cond my_loop
say x
say my_loop
</textarea>
<input type="button" value="Run" onclick="runCodeDom()"><br />
<canvas id=canvas></canvas>
<script>
var canvasEl = document.getElementById("canvas")
var textareaEl = document.getElementById("textarea")
var runCodeDom = function () {
  var code = textareaEl.value 
  return runCode(code)
}



// todo: set scope.scope = scope
// todo: maybe make an env = {scope: scope, i: i, lines: lines} + "?"
var commands = {
  set: function (args, scope) {
    y = scope[args[2]]
    scope[args[1]] = y 
  },
  setn: function (args, scope) {
    y = args[2] - 0
    scope[args[1]] = y
  },
  debugger: function () {
    debugger 
  },
  eq: function (args, scope) {
    return scope[args[1]] == scope[args[2]] 
  },
  label: function (args, scope) {
    scope[args[1]] = scope.__i 
  },
  incr: function (args, scope) {
    scope[args[1]] += 1
  },
  as: function (args, scope) {
    scope[args[1]] = scope.it 
  },
  say: function (args, scope) {
    console.log(scope[args[1]]) 
  },
  if_false_goto: function (args, scope) {
    if (scope[args[1]]) {
    
    } else {
      scope.__i = scope[args[2]]
    } 
  }

}
var runCode = function (code, scope) {
  scope = scope || {}
  scope.__i = 0
  var lines = code.split("\n")
  var len = lines.length
  var new_lines = []
  for (var i = 0; i < lines.length; i++) {
    new_lines.push(lines[i].split(" ")) 
  }
  lines = new_lines;
  while (true) {
    var line = lines[scope.__i]
    var command = line[0]
    if (command) {
      var ret = commands[command](line, scope)
      scope.it = ret
    } else {

    }
    scope.__i += 1 
    if (scope.__i === len) {
      break    
    }
  } 
}



</script>
</body>
</html>

